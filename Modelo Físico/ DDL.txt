CREATE TABLE Planos (
    plano_id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nome VARCHAR(40) NOT NULL,
    meses INT NOT NULL,
    preco_mensal DECIMAL(8,2) NOT NULL,
    descricao VARCHAR(200),
    ativo BIT NOT NULL DEFAULT 1
);

CREATE TABLE Instrutores (
    instrutor_id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nome VARCHAR(80) NOT NULL,
    cpf CHAR(11) UNIQUE,
    telefone VARCHAR(20),
    registro_CREF VARCHAR(10) DEFAULT 'Pleno',
    ativo BIT NOT NULL DEFAULT 1,
    contratado_em DATE
);

CREATE TABLE Modalidades (
    modalidade_id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nome VARCHAR(60) NOT NULL,
    descricao VARCHAR(200),
    instrutor_principal_id INT NULL,
    ativo BIT NOT NULL DEFAULT 1,
    FOREIGN KEY (instrutor_principal_id)
        REFERENCES Instrutores(instrutor_id)
);

CREATE TABLE Treinos (
    treino_id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    modalidade_id INT NOT NULL,
    instrutor_id INT NOT NULL,
    data_hora DATETIME NOT NULL,
    duracao_min TINYINT NOT NULL,
    local VARCHAR(80) NOT NULL,
    max_vagas SMALLINT DEFAULT 30,
    FOREIGN KEY (modalidade_id) REFERENCES Modalidades(modalidade_id),
    FOREIGN KEY (instrutor_id) REFERENCES Instrutores(instrutor_id)
);

CREATE TABLE Alunos (
    aluno_id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    cpf CHAR(11) UNIQUE,
    email VARCHAR(100) UNIQUE,
    telefone VARCHAR(20),
    data_nascimento DATE,
    sexo VARCHAR(1) DEFAULT 'O',
    criado_em DATETIME DEFAULT GETDATE(),
    ativo BIT NOT NULL DEFAULT 1
);

CREATE TABLE Assinatura (
    assinatura_id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    aluno_id INT NOT NULL,
    plano_id INT NOT NULL,
    inicio DATE NOT NULL,
    termino DATE NOT NULL,
    status BIT NOT NULL DEFAULT 1,
    criado_em DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (aluno_id) REFERENCES Alunos(aluno_id),
    FOREIGN KEY (plano_id) REFERENCES Planos(plano_id)
);

CREATE TABLE Pagamento (
    pagamento_id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    assinatura_id INT NOT NULL,
    valor DECIMAL(8,2) NOT NULL,
    data_pagamento DATE NOT NULL,
    metodo VARCHAR(10) DEFAULT 'Pix',
    status BIT NOT NULL DEFAULT 1,
    referencia VARCHAR(80),
    FOREIGN KEY (assinatura_id) REFERENCES Assinatura(assinatura_id)
);

CREATE TABLE Presencas (
    presenca_id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    aluno_id INT NOT NULL,
    treino_id INT NOT NULL,
    presente BIT NOT NULL DEFAULT 0,
    registrado_em DATETIME DEFAULT GETDATE(),
    observacao VARCHAR(200),
    FOREIGN KEY (aluno_id) REFERENCES Alunos(aluno_id),
    FOREIGN KEY (treino_id) REFERENCES Treinos(treino_id)
);
